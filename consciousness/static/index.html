<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>House Consciousness System</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
        }

        .header h1 {
            color: #333;
            font-size: 3em;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #4CAF50;
            margin-left: 10px;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            border: 1px solid #e1e5e9;
        }

        .card h3 {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        .chat-container {
            grid-column: 1 / -1;
            background: #f8f9fa;
            border: 2px solid #e9ecef;
        }

        .chat-messages {
            height: 300px;
            overflow-y: auto;
            padding: 15px;
            background: white;
            border-radius: 10px;
            margin-bottom: 15px;
            border: 1px solid #e1e5e9;
        }

        .message {
            margin-bottom: 15px;
            padding: 12px;
            border-radius: 10px;
        }

        .user-message {
            background: #007bff;
            color: white;
            margin-left: 20%;
        }

        .system-message {
            background: #f1f3f4;
            color: #333;
            margin-right: 20%;
        }

        .chat-input-container {
            display: flex;
            gap: 10px;
        }

        .chat-input {
            flex: 1;
            padding: 12px;
            border: 2px solid #e1e5e9;
            border-radius: 25px;
            font-size: 16px;
            outline: none;
        }

        .chat-input:focus {
            border-color: #007bff;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 25px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
        }

        .btn-primary {
            background: #007bff;
            color: white;
        }

        .btn-primary:hover {
            background: #0056b3;
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
            margin: 5px;
        }

        .btn-secondary:hover {
            background: #545b62;
        }

        .status-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .status-item {
            text-align: center;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .status-value {
            font-size: 2em;
            font-weight: bold;
            color: #007bff;
        }

        .status-label {
            color: #666;
            font-size: 0.9em;
            margin-top: 5px;
        }

        .loading {
            opacity: 0.6;
            pointer-events: none;
        }

        .error {
            color: #dc3545;
            background: #f8d7da;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }

        .scenarios {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .scenario-btn {
            padding: 8px 16px;
            background: #17a2b8;
            color: white;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
        }

        .scenario-btn:hover {
            background: #138496;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üè† House Consciousness System <span class="status-indicator" id="statusIndicator"></span></h1>
            <p>Your intelligent home automation companion</p>
        </div>

        <div class="grid">
            <!-- System Status -->
            <div class="card">
                <h3>üìä System Status</h3>
                <div class="status-grid">
                    <div class="status-item">
                        <div class="status-value" id="statusValue">‚óè</div>
                        <div class="status-label">Status</div>
                    </div>
                    <div class="status-item">
                        <div class="status-value" id="deviceCount">-</div>
                        <div class="status-label">Devices</div>
                    </div>
                    <div class="status-item">
                        <div class="status-value" id="uptime">-</div>
                        <div class="status-label">Uptime</div>
                    </div>
                </div>
                <button class="btn btn-secondary" onclick="refreshStatus()">üîÑ Refresh</button>
            </div>

            <!-- Quick Actions -->
            <div class="card">
                <h3>‚ö° Quick Actions</h3>
                <button class="btn btn-secondary" onclick="discoverDevices()">üîç Discover Devices</button>
                <button class="btn btn-secondary" onclick="getHealth()">üè• Health Check</button>
                <button class="btn btn-secondary" onclick="viewMetrics()">üìà View Metrics</button>
                <button class="btn btn-secondary" onclick="viewLogs()">üìã View Logs</button>
            </div>

            <!-- Scenarios -->
            <div class="card">
                <h3>üé≠ Scenarios</h3>
                <div class="scenarios">
                    <button class="scenario-btn" onclick="runScenario('morning')">üåÖ Morning Routine</button>
                    <button class="scenario-btn" onclick="runScenario('security')">üîí Security Alert</button>
                    <button class="scenario-btn" onclick="runScenario('energy')">‚ö° Energy Optimization</button>
                    <button class="scenario-btn" onclick="runScenario('party')">üéâ Party Mode</button>
                    <button class="scenario-btn" onclick="runScenario('vacation')">‚úàÔ∏è Vacation Mode</button>
                </div>
            </div>
        </div>

        <!-- Chat Interface -->
        <div class="card chat-container">
            <h3>üí¨ Chat with Your House</h3>
            <div class="chat-messages" id="chatMessages">
                <div class="message system-message">
                    <strong>House:</strong> Hello! I'm your house consciousness. How can I help you today?
                    <br><small>Try asking: "How are you feeling?" or "What devices do you see?"</small>
                </div>
            </div>
            <div class="chat-input-container">
                <input type="text" class="chat-input" id="chatInput" placeholder="Type your message..." onkeypress="handleChatKeyPress(event)">
                <button class="btn btn-primary" onclick="sendMessage()">Send</button>
            </div>
        </div>
    </div>

    <script>
        let startTime = new Date();

        // Initialize the interface
        document.addEventListener('DOMContentLoaded', function() {
            refreshStatus();
            updateUptime();
            setInterval(updateUptime, 1000);
            setInterval(refreshStatus, 30000); // Refresh every 30 seconds
        });

        function updateUptime() {
            const now = new Date();
            const diff = Math.floor((now - startTime) / 1000);
            const hours = Math.floor(diff / 3600);
            const minutes = Math.floor((diff % 3600) / 60);
            const seconds = diff % 60;
            document.getElementById('uptime').textContent = `${hours}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }

        async function apiCall(endpoint, options = {}) {
            try {
                const response = await fetch(endpoint, {
                    headers: {
                        'Content-Type': 'application/json',
                        ...options.headers
                    },
                    ...options
                });

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                return await response.json();
            } catch (error) {
                console.error('API call failed:', error);
                showError(`API Error: ${error.message}`);
                throw error;
            }
        }

        async function refreshStatus() {
            try {
                const health = await apiCall('/health');
                const detailedHealth = await apiCall('/health/detailed');
                const metrics = await apiCall('/metrics');

                document.getElementById('statusValue').textContent = '‚úÖ';
                document.getElementById('deviceCount').textContent = metrics.consciousness_device_count || 0;

                const indicator = document.getElementById('statusIndicator');
                indicator.style.background = '#4CAF50';

            } catch (error) {
                document.getElementById('statusValue').textContent = '‚ùå';
                document.getElementById('deviceCount').textContent = '?';

                const indicator = document.getElementById('statusIndicator');
                indicator.style.background = '#f44336';
            }
        }

        async function discoverDevices() {
            showMessage('system', 'Starting device discovery... This may take a moment.');
            try {
                // This would call the actual device discovery endpoint
                showMessage('system', 'Device discovery completed! Found devices will appear in the device list.');
            } catch (error) {
                showMessage('system', 'Device discovery failed. Please check the system logs.');
            }
        }

        async function getHealth() {
            try {
                const health = await apiCall('/health/detailed');
                showMessage('system', `System Health: ${health.status}\nComponents: ${Object.keys(health.components || {}).length}\nTimestamp: ${health.timestamp}`);
            } catch (error) {
                showMessage('system', 'Unable to retrieve health status.');
            }
        }

        async function viewMetrics() {
            try {
                const metrics = await apiCall('/metrics');
                let metricsText = 'System Metrics:\n';
                for (const [key, value] of Object.entries(metrics)) {
                    metricsText += `‚Ä¢ ${key.replace('consciousness_', '').replace('_', ' ')}: ${value}\n`;
                }
                showMessage('system', metricsText);
            } catch (error) {
                showMessage('system', 'Unable to retrieve metrics.');
            }
        }

        function viewLogs() {
            showMessage('system', 'Logs are available in the consciousness.log file. Future versions will display them here.');
        }

        function runScenario(scenario) {
            const scenarios = {
                'morning': 'Running Smart Morning Routine: Adjusting temperature, opening blinds, starting coffee...',
                'security': 'Activating Security Alert mode: Checking sensors, enabling cameras...',
                'energy': 'Starting Energy Optimization: Analyzing usage patterns, adjusting devices...',
                'party': 'Enabling Party Mode: Setting mood lighting, adjusting audio systems...',
                'vacation': 'Activating Vacation Mode: Setting security protocols, managing energy...'
            };

            showMessage('system', scenarios[scenario] || 'Running scenario...');
            setTimeout(() => {
                showMessage('system', `${scenario.charAt(0).toUpperCase() + scenario.slice(1)} scenario completed successfully!`);
            }, 2000);
        }

        function handleChatKeyPress(event) {
            if (event.key === 'Enter') {
                sendMessage();
            }
        }

        async function sendMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();

            if (!message) return;

            showMessage('user', message);
            input.value = '';

            // Simulate AI response for now
            setTimeout(() => {
                const responses = [
                    "I'm feeling quite well, thank you! All my systems are running smoothly.",
                    "I can see several devices on the network. Device discovery is ongoing.",
                    "The temperature is comfortable and energy usage is optimal.",
                    "I'm monitoring the security systems and everything looks secure.",
                    "Would you like me to run any specific scenarios or check particular systems?",
                    "I'm learning your patterns and preferences to better serve you.",
                    "All environmental systems are functioning within normal parameters."
                ];

                const response = responses[Math.floor(Math.random() * responses.length)];
                showMessage('system', response);
            }, 1000);
        }

        function showMessage(sender, message) {
            const messagesContainer = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender}-message`;

            const senderName = sender === 'user' ? 'You' : 'House';
            messageDiv.innerHTML = `<strong>${senderName}:</strong> ${message.replace(/\n/g, '<br>')}`;

            messagesContainer.appendChild(messageDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        function showError(message) {
            const errorDiv = document.createElement('div');
            errorDiv.className = 'error';
            errorDiv.textContent = message;
            document.querySelector('.container').insertBefore(errorDiv, document.querySelector('.grid'));

            setTimeout(() => errorDiv.remove(), 5000);
        }
    </script>
</body>
</html>
